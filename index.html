<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Smart Parking (4 Slots)</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
</head>
<body>
  <h2>üöó ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h2>

  <h3>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î</h3>
  <p id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>

  <hr>

  <h3>‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ</h3>
  <input type="text" id="plate" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ">
  <button onclick="checkIn()">‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ï‡∏£</button>

  <hr>

  <h3>‡∏£‡∏ñ‡∏≠‡∏≠‡∏Å</h3>
  <input type="text" id="plateOut" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ">
  <button onclick="checkOut()">‡∏£‡∏ñ‡∏≠‡∏≠‡∏Å</button>

  <script>
    // üî• ‡πÉ‡∏™‡πà config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "XXXX",
      appId: "XXXX"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const MAX_SLOT = 4;

    // üîÑ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
    db.ref("parking").on("value", (snapshot) => {
      const data = snapshot.val();
      const count = data ? Object.keys(data).length : 0;

      document.getElementById("status").innerHTML =
        `‡∏à‡∏≠‡∏î‡πÅ‡∏•‡πâ‡∏ß ${count} / ${MAX_SLOT} ‡∏Ñ‡∏±‡∏ô`;

      if (count >= MAX_SLOT) {
        document.getElementById("status").innerHTML += " ‚ùå ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß";
      } else {
        document.getElementById("status").innerHTML += " ‚úÖ ‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á";
      }
    });

    // ‚úÖ ‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤
    function checkIn() {
      const plate = document.getElementById("plate").value.trim();
      if (!plate) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ");
        return;
      }

      db.ref("parking").once("value", (snapshot) => {
        const data = snapshot.val();
        const count = data ? Object.keys(data).length : 0;

        if (count >= MAX_SLOT) {
          alert("‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!");
          return;
        }

        db.ref("parking/" + plate).set({
          plate: plate,
          timeIn: new Date().toLocaleString()
        });

        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÑ‡∏°‡πâ‡∏Å‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î");
        document.getElementById("plate").value = "";
      });
    }

    // üöó ‡∏£‡∏ñ‡∏≠‡∏≠‡∏Å
    function checkOut() {
      const plate = document.getElementById("plateOut").value.trim();
      if (!plate) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ");
        return;
      }

      db.ref("parking/" + plate).remove()
        .then(() => {
          alert("‡∏£‡∏ñ‡∏≠‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
          document.getElementById("plateOut").value = "";
        })
        .catch(() => {
          alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö");
        });
    }
  </script>
</body>
</html>
